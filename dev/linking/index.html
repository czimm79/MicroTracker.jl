<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Linking · MicroTracker.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://czimm79.github.io/MicroTracker.jl/linking/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="MicroTracker.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">MicroTracker.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../quickstart/">Quick Start</a></li><li><a class="tocitem" href="../settingupuser/">Setting Up</a></li><li><a class="tocitem" href="../pluto/">Pluto</a></li><li class="is-active"><a class="tocitem" href>Linking</a><ul class="internal"><li><a class="tocitem" href="#Input-parameters"><span>Input parameters</span></a></li><li><a class="tocitem" href="#Batch-linking"><span>Batch linking</span></a></li><li class="toplevel"><a class="tocitem" href="#Under-the-hood"><span>Under the hood</span></a></li></ul></li><li><a class="tocitem" href="../collapsing/">Collapsing</a></li><li><a class="tocitem" href="../visualization/">Visualization</a></li><li><a class="tocitem" href="../experimental/">Experimental</a></li><li><a class="tocitem" href="../segmenting/">Segmentation</a></li></ul></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../settingupdev/">Setting Up (for beginners)</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Linking</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Linking</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/czimm79/MicroTracker.jl/blob/master/docs/src/linking.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Linking"><a class="docs-heading-anchor" href="#Linking">Linking</a><a id="Linking-1"></a><a class="docs-heading-anchor-permalink" href="#Linking" title="Permalink"></a></h1><p>On this page, you will process the segmented data in <code>particle_data</code> into a single <code>linked_data</code> which contains the time-series trajectory data for all tracked microbots.</p><p>These commands can be run in the Julia REPL or in the generated Pluto notebook file after <a href="../settingupuser/#Creating-an-environment-for-your-project">Creating an environment for your project</a>. See the <a href="../pluto/#Pluto">Pluto</a> tutorial page to see an established workflow.</p><h2 id="Input-parameters"><a class="docs-heading-anchor" href="#Input-parameters">Input parameters</a><a id="Input-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Input-parameters" title="Permalink"></a></h2><p>Now, let&#39;s format our inputs to the linking process, the <code>translation_dict</code> and <code>linking_settings</code>.</p><h3 id="Translation-Dictionary"><a class="docs-heading-anchor" href="#Translation-Dictionary">Translation Dictionary</a><a id="Translation-Dictionary-1"></a><a class="docs-heading-anchor-permalink" href="#Translation-Dictionary" title="Permalink"></a></h3><p>Provided you&#39;ve followed the requirements for filenaming detailed in <a href="../experimental/#Experimental">Experimental</a>, you now need to tell MicroTracker what your independent variables are. This is in the form of a Dictionary where the key is the name of the variable and the value is a tuple of the index and type. Following the example in <a href="../experimental/#Experimental">Experimental</a>, we have a filename that looks like <code>32_6p2_1</code>. The translation dictionary would then look like:</p><pre><code class="language-julia hljs">translation_dict = Dict(&quot;T_C&quot; =&gt; (1, Float64), &quot;B_mT&quot; =&gt; (2, Float64))</code></pre><p>In plain english, this is telling MicroTracker that the temperature is recorded in the first position and is a floating point number (can have decimal places) and the field strength is a floating point number in the second position. These are the possible types a variable in a filename can have:</p><ul><li><code>Int64</code> If an integer variable makes sense, like number of washes, number of particles, etc.</li><li><code>Float64</code> Most variables, a floating point number.</li><li><code>String</code> If the variable makes most sense if its a string. Like <code>&quot;washed&quot;</code> or <code>&quot;aerosolized&quot;</code>.</li></ul><p>Here, we know the FPS of our videos is constant across all videos, so we&#39;ll include it in the <code>linking_settings</code> below.</p><h3 id="Linking-Settings"><a class="docs-heading-anchor" href="#Linking-Settings">Linking Settings</a><a id="Linking-Settings-1"></a><a class="docs-heading-anchor-permalink" href="#Linking-Settings" title="Permalink"></a></h3><p>The linking settings are in the format of a <code>NamedTuple</code>. This <code>linking_settings</code> contains information about your video, like the microns per pixel (MPP) of your microscope setup and the frames per second of your video (FPS). It also contains parameters to feed to the underlying linking machinery in <a href="https://soft-matter.github.io/trackpy/v0.6.1/generated/trackpy.link.html#trackpy.link">trackpy.link</a>.</p><pre><code class="language-julia hljs">linking_settings = (
    MPP = 0.605,  # Microns per pixel, scale of objective.
    SEARCH_RANGE_MICRONS = 1000, # microns/s. Fastest a particle could be traveling. Determines &quot;how far&quot; to look to link.
    MEMORY = 0,  # number of frames the blob can disappear and still be remembered
    STUBS_SECONDS = 0.5,  # trajectory needs to exist for at least this many seconds 
    FPS = 60.0 # Frames per second. **Can omit if the FPS has been specified in the filename.**
)</code></pre><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>MicroTracker supports videos having different framerates, as long as this information is recorded in the filename. For an example of this, see the included examples and Pluto notebook.</p><p>If instead the FPS across all videos is constant, we can include the <code>FPS</code> parameter in <code>linking_settings</code> and the exclude any mention of <code>FPS</code> in our <code>translation_dict</code>, as shown above.</p></div></div><h2 id="Batch-linking"><a class="docs-heading-anchor" href="#Batch-linking">Batch linking</a><a id="Batch-linking-1"></a><a class="docs-heading-anchor-permalink" href="#Batch-linking" title="Permalink"></a></h2><p>Now that we&#39;ve formatted and defined our <code>translation_dict</code> and <code>linking_settings</code>, its time to link.</p><p>The function <a href="../api/#MicroTracker.batch_particle_data_to_linked_data-Tuple{Dict, NamedTuple}"><code>batch_particle_data_to_linked_data</code></a> is the 1-command version which runs all of the processing steps at once for every video. If you&#39;d like to separate out the process and tinker with each step, see the <a href="#Under-the-hood">Under the hood</a> section below. </p><pre><code class="language-julia-repl hljs">julia&gt; linked_data = batch_particle_data_to_linked_data(translation_dict, linking_settings)
...output snipped</code></pre><p>And just like that - all the segmented data in <code>particle_data</code> has been linked into continuous microbot trajectories and concatenated into one <a href="https://dataframes.juliadata.org/stable/">DataFrame</a>, here the variable <code>linked_data</code>. This data contains the instantaneous velocity, size, and much more over the entire experimental lifetime of the microbot.</p><h1 id="Under-the-hood"><a class="docs-heading-anchor" href="#Under-the-hood">Under the hood</a><a id="Under-the-hood-1"></a><a class="docs-heading-anchor-permalink" href="#Under-the-hood" title="Permalink"></a></h1><p>Continue to <a href="../collapsing/#Collapsing">Collapsing</a> after batch linking. However, if you&#39;d like to insert in your own processing step in the pipeline, here are the sub-functions that make up <a href="../api/#MicroTracker.batch_particle_data_to_linked_data-Tuple{Dict, NamedTuple}"><code>batch_particle_data_to_linked_data</code></a> for your convenience. These functions are applied in order, from <code>particle_data</code> to <code>linked_data</code>.</p><article class="docstring"><header><a class="docstring-binding" id="MicroTracker.load_particle_data" href="#MicroTracker.load_particle_data"><code>MicroTracker.load_particle_data</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load_particle_data(video_name::AbstractString)</code></pre><p>Read a particle data <code>.csv</code> located in <code>/particle_data</code> into a <code>DataFrame</code>.</p><p>If the <code>.csv</code> file is from ImageJ (contains X, Y, and Label columns, not x, y, and frame), it will:</p><ol><li>Extract the frame number from the label column and add it as a new column using <a href="#MicroTracker.extract_frame_from_label-Tuple{AbstractString}"><code>extract_frame_from_label</code></a></li><li>Rename the <code>X</code> and <code>Y</code> columns to <code>x</code> and <code>y</code> so it works with <a href="../linking/#MicroTracker.link"><code>link</code></a>.</li><li>Remove any columns with a blank name.</li><li>Rename the <code>Circ.</code> column to <code>Circ</code> so it works with Julia symbol notation.</li></ol></div><a class="docs-sourcelink" target="_blank" href="https://github.com/czimm79/MicroTracker.jl/blob/fd3ad402d363eb646a33efd8814cfa29cd5326e0/src/particle_data.jl#L33-L43">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MicroTracker.add_info_columns_from_filename" href="#MicroTracker.add_info_columns_from_filename"><code>MicroTracker.add_info_columns_from_filename</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_info_columns_from_filename(particle_data::AbstractDataFrame, translation_dict::AbstractDict)</code></pre><p>Extract experimental metadata from the <code>filename</code> column and create a new column for each in <code>particle_data</code>. Returns a new <code>DataFrame</code>.</p><p>Assumes the filename is separated by underscores and periods are denoted by <code>p</code>. The <code>translation_dict</code> details the filename format. For full explanation, see the MicroTracker docs: <a href="../linking/#Translation-Dictionary">Translation Dictionary</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/czimm79/MicroTracker.jl/blob/fd3ad402d363eb646a33efd8814cfa29cd5326e0/src/particle_data.jl#L75-L83">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MicroTracker.link" href="#MicroTracker.link"><code>MicroTracker.link</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">link(particle_data::AbstractDataFrame, linking_settings::NamedTuple; trackpykwargs...)</code></pre><p>Use trackpy to link particle data into trajectories across frames.</p><p>See the <a href="../linking/#Linking-Settings">Linking Settings</a> docs for the fields and format of <code>linking_settings</code>. Any kwargs will be passed to the trackpy.link function <a href="https://soft-matter.github.io/trackpy/v0.6.1/generated/trackpy.link.html#trackpy.link">trackpy.link</a>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; link(particle_data, linking_settings)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/czimm79/MicroTracker.jl/blob/fd3ad402d363eb646a33efd8814cfa29cd5326e0/src/linked_data.jl#L34-L46">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MicroTracker.add_resolution_column!" href="#MicroTracker.add_resolution_column!"><code>MicroTracker.add_resolution_column!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_resolution_column!(particle_data::AbstractDataFrame)</code></pre><p>Look at a frame of the video in <code>original_video</code> which corresponds to the data and add a column for the resolution of type Tuple{Int, Int}. Modifies <code>particle_data</code> in place, signfified by the <code>!</code> in the function name.</p><p>Uses <a href="#MicroTracker.getvideoresolution-Tuple{AbstractString}"><code>getvideoresolution</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/czimm79/MicroTracker.jl/blob/fd3ad402d363eb646a33efd8814cfa29cd5326e0/src/particle_data.jl#L105-L112">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MicroTracker.add_useful_columns" href="#MicroTracker.add_useful_columns"><code>MicroTracker.add_useful_columns</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_useful_columns(linked_data::AbstractDataFrame, linking_settings::NamedTuple)</code></pre><p>After linking, add some useful columns to the dataframe, like include dx, dy, dp (speed), and size measurements in microns. </p><p>Uses the <a href="#MicroTracker.numerical_derivative-Tuple{AbstractVector}"><code>numerical_derivative</code></a> and <a href="#MicroTracker.total_displacement-Tuple{AbstractVector, AbstractVector}"><code>total_displacement</code></a> functions.</p><p><strong>Definitions</strong></p><ul><li><code>particle_unique</code> : a string which uniquely identifies a particle. This is a combination of the filename and the particle number.</li><li><code>dx</code> : numerical derivative of <code>x</code>, i.e. instantaneous velocity in the x direction. Units of pixels/frame.</li><li><code>dy</code> : numerical derivative of <code>y</code>, i.e. instantaneous velocity in the y direction. Units of pixels/frame.</li><li><code>dp</code> : instantaneous speed. √(dx^2 + dy^2). Units of pixels/frame.</li><li><code>dx_um</code> : dx converted to µm/s.</li><li><code>dy_um</code> : dy converted to µm/s.</li><li><code>dp_um</code> : dp converted to µm/s.</li><li><code>total_displacement_um</code> : total displacement of the microbot. Constant on every row, since this is a total. Units of µm.</li><li><code>Area_um</code> : area of the microbot. Units of µm^2.</li><li><code>time</code> : time, converted from the frame column. Units of seconds.</li><li><code>Major_um</code> : major axis of the fit ellipse of the microbot. Units of µm.</li><li><code>Minor_um</code> : minor axis of the fit ellipse of the microbot. Units of µm.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/czimm79/MicroTracker.jl/blob/fd3ad402d363eb646a33efd8814cfa29cd5326e0/src/linked_data.jl#L92-L112">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MicroTracker.clip_trajectory_edges" href="#MicroTracker.clip_trajectory_edges"><code>MicroTracker.clip_trajectory_edges</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">clip_trajectory_edges(linked_data::AbstractDataFrame, linking_settings::NamedTuple)</code></pre><p>Iterate through each trajectory and remove the tracking data where the particle is out of frame.</p><p>The particle is out of frame when the center is within the radius of the particle from the edge of the video.</p><p>Uses <a href="#MicroTracker.find_trajectory_bounds-Tuple{AbstractDataFrame}"><code>find_trajectory_bounds</code></a> to find the bounds of the trajectory with <a href="#MicroTracker.inbounds-Tuple{DataFrameRow, AbstractFloat, Tuple{Int64, Int64}}"><code>inbounds</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/czimm79/MicroTracker.jl/blob/fd3ad402d363eb646a33efd8814cfa29cd5326e0/src/linked_data.jl#L274-L281">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../pluto/">« Pluto</a><a class="docs-footer-nextpage" href="../collapsing/">Collapsing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Sunday 9 July 2023 17:58">Sunday 9 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
